<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>공지사항 | LS Works</title>
  <link rel="stylesheet" href="style-notices.css">
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container header-flex">
      <a href="index.html" class="logo">
        <img src="assets/logo.png" alt="LS Works 로고">
        <span>Los Santos Works</span>
      </a>
      <nav>
        <ul class="nav-links">
          <li><a href="index.html">홈</a></li>
          <li><a href="about.html">기업 소개</a></li>
          <li><a href="services.html">사업 안내</a></li>
          <li><a href="notices.html" class="active">공지사항</a></li>
        </ul>
      </nav>
      <button class="login-btn" id="loginBtn">로그인</button>
    </div>
  </header>

  <!-- 공지사항 메인 -->
  <main class="container">
    <h1>공지사항</h1>
    <div id="notice-list" class="notice-list"></div>
    <button id="addNoticeBtn" class="add-btn">+ 공지 추가</button>
  </main>

  <!-- 공지 상세 모달 -->
  <div id="noticeModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="modal-title"></h2>
      <p id="modal-date"></p>
      <div id="modal-content"></div>
    </div>
  </div>

  <!-- 공지 추가 모달 -->
  <div id="addNoticeModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>새 공지 추가</h2>
      <input type="text" id="new-title" placeholder="제목 입력">
      <textarea id="new-content" placeholder="내용 입력"></textarea>
      <button id="saveNotice">저장</button>
    </div>
  </div>

  <!-- 로그인 모달 -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>로그인</h2>
      <input type="text" id="username" placeholder="아이디">
      <input type="password" id="password" placeholder="비밀번호">
      <button id="loginSubmit">로그인</button>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <p>&copy; 2025 LS Works. All rights reserved.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzwjYMWl1DKf_e8iMSsdpW6qdt03blGxHQaBaaZyv--i_D_0YNBaM7Qpjr08tI4ECQPGQ/exec";

    // 공지 생성 함수
    function createNoticeCard(date, title, content){
      const list = document.getElementById("notice-list");
      const card = document.createElement("div");
      card.className = "notice-card";
      card.innerHTML = `
        <h3>${title}</h3>
        <p>${date.split("T")[0]}</p>
      `;
      card.addEventListener("click", ()=>{
        document.getElementById("modal-title").innerText = title;
        document.getElementById("modal-date").innerText = date.split("T")[0];
        document.getElementById("modal-content").innerText = content;
        document.getElementById("noticeModal").style.display="block";
      });
      list.prepend(card);
    }

    // Google Sheets에서 불러오기 (JSONP)
    function loadNotices(){
      const script = document.createElement("script");
      script.src = WEB_APP_URL + "?callback=displayNotices";
      document.body.appendChild(script);
    }

    function displayNotices(data){
      if(!data || !data.notices) return;
      data.notices.forEach(n=>{
        createNoticeCard(n.date, n.title, n.content);
      });
    }

    // 공지 저장 (CORS-safe)
    document.getElementById("saveNotice").addEventListener("click", async ()=>{
      const title = document.getElementById("new-title").value;
      const content = document.getElementById("new-content").value;
      const date = new Date().toISOString();

      if(title && content){
        createNoticeCard(date, title, content);

        try {
          const params = new URLSearchParams();
          params.append("title", title);
          params.append("content", content);
          params.append("date", date);

          await fetch(WEB_APP_URL, {
            method: "POST",
            body: params
          });
        } catch(err){
          console.error("Google Sheets 저장 실패:", err);
          alert("Google Sheets 저장 실패! 서버 문제일 수 있습니다.");
        }

        document.getElementById("addNoticeModal").style.display="none";
        document.getElementById("new-title").value='';
        document.getElementById("new-content").value='';
      }
    });

    // 모달 제어
    const modals = document.querySelectorAll(".modal");
    document.querySelectorAll(".close").forEach((btn, idx)=>{
      btn.addEventListener("click", ()=> modals[idx].style.display="none");
    });
    window.addEventListener("click", e=>{
      modals.forEach(m=>{ if(e.target===m) m.style.display="none"; });
    });

    document.getElementById("addNoticeBtn").addEventListener("click", ()=>{
      document.getElementById("addNoticeModal").style.display="block";
    });
    document.getElementById("loginBtn").addEventListener("click", ()=>{
      document.getElementById("loginModal").style.display="block";
    });

    // 초기 로드
    loadNotices();
  </script>
</body>
</html>
